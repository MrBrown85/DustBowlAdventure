<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dust Bowl Adventure: A Historical Journey</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 15px;
      line-height: 1.8;
      font-size: 18px;
    }
    #game {
      max-width: 100%;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.15);
    }
    button {
      margin: 8px 5px 8px 0;
      padding: 12px 15px;
      font-size: 18px;
      border: none;
      border-radius: 4px;
      background-color: #3498db;
      color: #fff;
      cursor: pointer;
    }
    button:hover {
      background-color: #2980b9;
    }
    .choice {
      display: block;
      margin-top: 12px;
      width: 100%;
      text-align: left;
    }
    .nav-buttons {
      margin-top: 25px;
      border-top: 1px solid #ddd;
      padding-top: 15px;
    }
    #transcript {
      margin-top: 30px;
      background: #eef;
      border-left: 4px solid #88a;
      padding: 15px;
      font-style: italic;
      white-space: pre-line;
    }
    input[type="text"], select {
      padding: 10px;
      font-size: 18px;
      width: 100%;
      margin-bottom: 15px;
      box-sizing: border-box;
    }
    h2 {
      font-size: 24px;
      margin-bottom: 15px;
    }
    h3 {
      font-size: 22px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div id="game"></div>
  <script>
    // Global variables for player identity, navigation history, and transcript.
    let playerName = "";
    let playerRole = "";
    let pathStack = [];  // Stack of node IDs for back navigation.
    let transcript = []; // Full transcript of the journey.

    // Replace placeholders {name} and {role} in text.
    function parseText(text) {
      return text.replace(/{name}/g, playerName).replace(/{role}/g, playerRole);
    }

    // Story nodes with clear, textbook-like narrative and factual information.
    const storyNodes = {
      "start": {
        text: "It is the fall of 1935. The American heartland has been severely affected by the Dust Bowl and the Great Depression. You, {name} the {role}, stand on land that once produced abundant crops. Due to poor farming practices and a long drought, the soil is now dry and full of dust. Historians explain that the Dust Bowl was caused by both natural weather patterns and unsustainable agriculture. Your choice now is whether to remain on your farm and try to restore the land, or to move to the city where opportunities might be available.",
        choices: [
          { text: "Stay on the farm", next: "stay_farm" },
          { text: "Head to the city", next: "city_intro" }
        ]
      },
      "stay_farm": {
        text: "You decide to stay on the family farm. As you walk through the fields, you see cracked earth where crops once grew. This damage happened because farmers did not use methods such as crop rotation or soil conservation. Later, new government programs would help improve these practices. Now, you must decide how to move forward on the farm.",
        choices: [
          { text: "Try to save what crops remain", next: "salvage_crops" },
          { text: "Save your resources and wait", next: "conserve_resources" }
        ]
      },
      "salvage_crops": {
        text: "You work hard to gather the remaining crops from the field. Although the harvest is small, it shows that some life still remains in the soil. Farmers during the Dust Bowl often risked everything to save their crops, and this effort represents hope for the future.",
        choices: [
          { text: "Sell your crops at the local market", next: "sell_crops" },
          { text: "Use the crops to feed your family", next: "feed_family" }
        ]
      },
      "conserve_resources": {
        text: "You choose to conserve your limited resources, knowing that every bit of food, water, and fuel is important. During the Great Depression, many families learned to live with very little. This careful management of resources was essential for survival and later influenced government programs aimed at stabilizing the economy.",
        choices: [
          { text: "Try new farming methods", next: "invest_techniques" },
          { text: "Visit a nearby town for help", next: "seek_assistance" }
        ]
      },
      "sell_crops": {
        text: "At the market, you sell your small harvest. The low prices reflect the severe drop in crop values during the Depression. Even though you earn only a little money, every coin is valuable. This situation helped many farmers later to think of new ways to support themselves.",
        choices: [
          { text: "Return to the farm to keep working", next: "return_farm" },
          { text: "Save money and move to the city", next: "save_money_city" }
        ]
      },
      "feed_family": {
        text: "You decide to use your harvest to feed your family. Sharing a meal during these hard times was an important part of surviving the Depression. Communities often came together to support one another when food was scarce.",
        choices: [
          { text: "Look for more food in the wild", next: "find_food" },
          { text: "Travel to barter for supplies", next: "barter_journey" }
        ]
      },
      "invest_techniques": {
        text: "You invest in new farming methods such as crop rotation and contour plowing. These methods were later recognized as ways to prevent soil erosion and restore the land. Many farmers began to use these techniques after the lessons of the Dust Bowl were learned.",
        choices: [
          { text: "Work hard on the farm", next: "farm_success" },
          { text: "Consider moving to the city", next: "city_intro" }
        ]
      },
      "seek_assistance": {
        text: "You travel to a nearby town and meet other people facing similar hardships. In many communities, farmers formed cooperatives to share ideas and resources. This support helped them overcome the challenges of the Depression. With new knowledge and community support, you return to your farm.",
        choices: [
          { text: "Join a local cooperative", next: "join_cooperative" },
          { text: "Return to your farm with fresh ideas", next: "return_farm" }
        ]
      },
      "return_farm": {
        text: "Back on your farm, you resume your work with renewed determination. Every effort you make is based on lessons learned from the past. Historians note that the struggles of farmers during the Dust Bowl led to major changes in farming practices and government policies.",
        choices: [
          { text: "Keep working hard on the land", next: "farm_success" },
          { text: "Consider that the city might offer better prospects", next: "city_intro" }
        ]
      },
      "save_money_city": {
        text: "You start saving your money carefully, planning for a possible move to the city. Although the city offers new opportunities, it also comes with challenges such as overcrowding and unemployment. Many families left the rural areas in search of better lives, even though the urban environment was difficult.",
        choices: [
          { text: "Stay on the farm to save more", next: "wait_farm" },
          { text: "Use your savings and go to the city", next: "city_intro" }
        ]
      },
      "find_food": {
        text: "You search the surrounding countryside and find wild plants and berries that can help supplement your family’s meals. Foraging was an important survival skill during the Dust Bowl when traditional crops failed.",
        choices: [
          { text: "Return to your farm with the food", next: "return_farm" },
          { text: "Share the food with your neighbors", next: "share_food" }
        ]
      },
      "barter_journey": {
        text: "You decide to travel and barter for essential supplies. With little cash available, exchanging goods became a common practice during the Depression. This barter system helped many families survive and even build new networks for support.",
        choices: [
          { text: "Return home with the supplies", next: "return_farm" },
          { text: "Set up a small trade route with other farmers", next: "trade_route" }
        ]
      },
      "farm_success": {
        text: "Your hard work on the farm begins to pay off. The damaged land shows signs of recovery as you use both traditional methods and new techniques. This slow recovery mirrors the larger agricultural reforms that would later be supported by government programs. Your efforts serve as a model of determination and adaptability.",
        choices: [
          { text: "Continue working on the land", next: "farm_success" },
          { text: "Expand your farm to try new ideas", next: "expand_farm" },
          { text: "Test your prospects in the city", next: "city_intro" }
        ]
      },
      "join_cooperative": {
        text: "You decide to join a cooperative of local farmers. By sharing ideas, tools, and labor, you and your neighbors work together to improve your farms. This cooperative effort is an early example of community-based solutions that later helped shape national policies.",
        choices: [
          { text: "Work on communal farming projects", next: "communal_farming" },
          { text: "After a while, return to managing your own farm", next: "return_farm" }
        ]
      },
      "communal_farming": {
        text: "Working together on a communal plot of land, you and your neighbors learn that cooperation can lead to better results than working alone. The shared success of communal farming is a lesson in how community action can overcome even the toughest challenges.",
        choices: [
          { text: "Celebrate your shared success", next: "ending_success" },
          { text: "Plan further improvements for the community", next: "invest_wisely" }
        ]
      },
      "expand_farm": {
        text: "With cautious optimism, you decide to expand your farm. You begin to raise livestock and experiment with different types of crops. This mixed approach is later recognized as a sound method to reduce risk and improve food production. Your farm now reflects both traditional practices and new ideas.",
        choices: [
          { text: "Focus on raising livestock", next: "livestock" },
          { text: "Experiment with a variety of crops", next: "diverse_crops" }
        ]
      },
      "wait_farm": {
        text: "You remain on your farm, patiently waiting for rain to return and revive the soil. The long, dry days remind you that the drought was one of the major causes of the Dust Bowl. This waiting period also led to the development of new water conservation methods in later years.",
        choices: [
          { text: "Continue to work on the land", next: "farm_success" },
          { text: "Join a group of migrants looking for better land", next: "migrate" }
        ]
      },
      "trade_route": {
        text: "You work on building a small local trade network with other farmers. In an economy where money was scarce, exchanging goods directly became very important. This barter system helped support families and fostered a sense of community that was crucial during the Depression.",
        choices: [
          { text: "Expand your trade network", next: "trade_growth" },
          { text: "Return to focusing on your own farm", next: "farm_success" }
        ]
      },
      "livestock": {
        text: "You decide to focus on raising livestock. Animals provide a steady supply of food and products, and they become a valuable asset for trade. This method of farming would later be recognized as an important part of sustainable agriculture.",
        choices: [
          { text: "Build better shelters for your animals", next: "animal_shelters" },
          { text: "Use your livestock to help with trade", next: "trade_route" }
        ]
      },
      "diverse_crops": {
        text: "You experiment with growing a variety of crops. By planting different types, especially those that require less water, you try to reduce the risk of a complete crop failure. This approach is now considered a key part of sustainable farming and was one lesson learned from the Dust Bowl.",
        choices: [
          { text: "Keep experimenting with new crop combinations", next: "diverse_crops_success" },
          { text: "Return to methods you know work well", next: "farm_success" }
        ]
      },
      "migrate": {
        text: "With a heavy heart, you pack your few belongings and join a caravan of migrants searching for better land. Many families left their homes during the Dust Bowl in hope of a fresh start. This journey, though difficult, represents the spirit of determination that carried people through one of America’s toughest times.",
        choices: [
          { text: "Press on despite the challenges", next: "migrant_success" },
          { text: "Decide to return to your farm", next: "return_farm" }
        ]
      },
      "trade_growth": {
        text: "Your trade network grows, and you begin to see modest profits. This system of barter and exchange was essential when traditional money lost much of its value. It shows how communities could adapt and support each other in hard times.",
        choices: [
          { text: "Use your network to gain more prosperity", next: "prosperity" },
          { text: "Focus back on your own farm", next: "farm_success" }
        ]
      },
      "diverse_crops_success": {
        text: "Your experiments with different crops pay off. The fields show signs of recovery as your innovative methods begin to work. This success is a clear example of how learning from past mistakes can lead to better farming practices, a lesson that would later influence modern agriculture.",
        choices: [
          { text: "Continue trying new methods", next: "diverse_crops_success" },
          { text: "Return to the reliable methods of the past", next: "farm_success" }
        ]
      },
      "prosperity": {
        text: "Slowly, a sense of prosperity begins to emerge. Your efforts, along with new government programs, help the local economy recover. This period marked the beginning of a long process that would eventually restore stability to the nation. Your journey is a clear example of how perseverance and smart choices can lead to improvement even in difficult times.",
        choices: [
          { text: "Invest your gains for a secure future", next: "invest_wisely" },
          { text: "Expand your trade network further", next: "trade_growth" }
        ]
      },
      "animal_shelters": {
        text: "By building better shelters for your animals, you see an improvement in their health and productivity. This practical step is one of many changes that helped farmers learn how to work with nature rather than against it.",
        choices: [
          { text: "Expand your livestock operation", next: "livestock_success" },
          { text: "Try diversifying your farm again", next: "diverse_crops" }
        ]
      },
      "livestock_success": {
        text: "Your livestock operation becomes a stable part of your farm. The steady supply of food and trade goods shows how important livestock can be to a sustainable farming system. Your success is an example of how adapting to new methods can lead to long-term stability.",
        choices: [
          { text: "Invest in community projects", next: "community_build" },
          { text: "Expand your business further", next: "invest_wisely" }
        ]
      },
      "invest_wisely": {
        text: "You decide to invest your savings in local projects and small businesses. This approach was a key part of the New Deal, which helped rebuild the economy by supporting community growth. Your wise investments help secure not only your future but also contribute to the recovery of your region.",
        choices: [
          { text: "Keep investing for a better future", next: "invest_wisely" },
          { text: "Strengthen community ties", next: "community_build" }
        ]
      },
      "community_build": {
        text: "Working with your neighbors, you build a strong and supportive community. The cooperative spirit that develops helps everyone survive and eventually thrive. Historians later point to these community efforts as an important part of the recovery from the Great Depression.",
        choices: [
          { text: "Celebrate your community's success", next: "ending_success" },
          { text: "Plan for further community improvements", next: "invest_wisely" }
        ]
      },
      "ending_success": {
        text: "Your journey through the Dust Bowl and the Great Depression ends in success. As {name} the {role}, you have worked hard to restore the land and build a better future. Your story shows how practical changes in farming, strong community support, and perseverance can overcome even the toughest challenges. This record of your journey is an important lesson in history.",
        choices: [
          { text: "View Your Full Journey Transcript", next: "transcript_view" }
        ],
        final: true
      },
      "share_food": {
        text: "In an act of kindness, you share your gathered food with neighbors who are struggling as well. This simple gesture reflects the strong sense of community that helped many families survive the harsh conditions of the Depression.",
        choices: [
          { text: "Return to your farm with hope", next: "return_farm" },
          { text: "Help build a community garden", next: "community_build" }
        ]
      },
      // City branch nodes
      "city_intro": {
        text: "You arrive in a large city where crowded streets and busy markets mix with hardship. The city during the Great Depression was a place of both challenge and opportunity. Many people left the countryside hoping for work and a fresh start, even though urban life came with its own set of problems such as unemployment and overcrowding.",
        choices: [
          { text: "Take any available labor job", next: "laborer" },
          { text: "Get involved in political activism", next: "activism" },
          { text: "Start a small business", next: "small_business" }
        ]
      },
      "laborer": {
        text: "You take a job as a laborer, working long hours for very little pay. The difficult working conditions in the city led many workers to organize unions and demand better treatment. Your experience is similar to that of countless others who struggled to make ends meet during the Depression.",
        choices: [
          { text: "Save money to one day start your own business", next: "save_money_city" },
          { text: "Join a union to fight for better wages", next: "union_join" }
        ]
      },
      "activism": {
        text: "Motivated by a strong sense of justice, you become involved in political activism. You join protests and community meetings to demand better living conditions and fair treatment. This activism played an important role in the reforms of the New Deal, which improved working conditions for many Americans.",
        choices: [
          { text: "Organize a large protest", next: "protest" },
          { text: "Help build local community support", next: "grassroots" }
        ]
      },
      "small_business": {
        text: "Using your savings, you open a small business in the city. Even though consumer spending is low, you work hard to provide a needed service or product. Your venture is an example of the entrepreneurial spirit that emerged even in tough times.",
        choices: [
          { text: "Innovate to make your business stand out", next: "business_innovation" },
          { text: "Cut costs to keep your business running", next: "business_cut" }
        ]
      },
      "save_money_city": {
        text: "You work diligently as a laborer, saving every penny in hopes of a better future. The discipline you show is similar to that of many who struggled in the city, where every dollar mattered. Your savings represent both hope and hard work.",
        choices: [
          { text: "Continue working and saving", next: "laborer" },
          { text: "Invest your savings in a new business opportunity", next: "small_business" }
        ]
      },
      "union_join": {
        text: "You join a union to help secure fair wages and better working conditions for all. The union was a powerful tool during the Depression and played a key role in the improvements made under the New Deal. Your membership is part of a larger movement for workers' rights.",
        choices: [
          { text: "Take on a leadership role", next: "union_leader" },
          { text: "Focus on your job and savings", next: "laborer" }
        ]
      },
      "protest": {
        text: "You lead a protest in the city, where many gather to demand justice and change. The protests of the Depression era helped bring about important reforms in labor laws and social policies. Your efforts contribute to a movement that reshaped the nation.",
        choices: [
          { text: "Channel your energy into union efforts", next: "union_join" },
          { text: "Confront the authorities directly", next: "police_encounter" }
        ]
      },
      "grassroots": {
        text: "You work with local community groups to provide food, shelter, and support to those in need. These grassroots efforts were essential during the Depression and later helped inspire many New Deal programs. Your work makes a real difference in your community.",
        choices: [
          { text: "Form a local support group", next: "community_support" },
          { text: "Return to steady labor work", next: "laborer" }
        ]
      },
      "business_innovation": {
        text: "Your innovative ideas help your business stand out in a difficult market. This creativity is a testament to the resilience and resourcefulness of entrepreneurs during the Depression. Your success is one example of how innovation can drive change.",
        choices: [
          { text: "Expand your business", next: "business_growth" },
          { text: "Keep your business small", next: "business_stable" }
        ]
      },
      "business_cut": {
        text: "By cutting costs, you manage to keep your business running even in a tough economy. This careful balance of quality and frugality was a constant challenge for many business owners during the Depression.",
        choices: [
          { text: "Invest in improving your product", next: "business_innovation" },
          { text: "Continue with your cost-cutting strategy", next: "business_stable" }
        ]
      },
      "union_leader": {
        text: "You rise as a leader in your union, helping to negotiate better wages and working conditions. Your leadership reflects the broader changes that occurred in labor laws during this time. Your actions contribute to the long-term improvement of workers’ rights.",
        choices: [
          { text: "Continue leading the fight", next: "union_leader" },
          { text: "Return to your personal job", next: "laborer" }
        ]
      },
      "police_encounter": {
        text: "A confrontation with the police forces you to rethink your approach to activism. Such encounters were common and highlighted the risks involved in demanding change. You decide to work quietly to rebuild community support.",
        choices: [
          { text: "Lay low and rebuild grassroots support", next: "grassroots" },
          { text: "Continue activism in a more cautious way", next: "grassroots" }
        ]
      },
      "community_support": {
        text: "The support group you help form becomes a crucial resource for many people in the city. In a time when government help was limited, community efforts like these were vital. Your work in the support group shows how local action can make a difference.",
        choices: [
          { text: "Use the group to rebuild the community", next: "community_build" },
          { text: "Return to your business for personal success", next: "small_business" }
        ]
      },
      "business_growth": {
        text: "Your business grows steadily, providing more jobs and a better service to your community. This growth is a sign of hope during a very difficult period, showing that even in a time of economic hardship, progress is possible.",
        choices: [
          { text: "Hire more workers and expand further", next: "business_employment" },
          { text: "Reinvest in your business", next: "business_innovation" }
        ]
      },
      "business_stable": {
        text: "Your business remains a steady source of income in a challenging economic climate. Stability is a small victory during the Depression, and your careful management is a model of resilience.",
        choices: [
          { text: "Explore new business ventures", next: "small_business" },
          { text: "Keep saving money for future changes", next: "save_money_city" }
        ]
      },
      "business_employment": {
        text: "By hiring additional workers, your business not only grows but also helps provide jobs for others. Job creation was a key part of the recovery during the Depression, and your efforts contribute to this larger effort.",
        choices: [
          { text: "Invest in your community", next: "community_build" },
          { text: "Expand your business further", next: "business_growth" }
        ]
      }
    };

    // Render a node or a special screen with navigation.
    function renderNode(nodeId, isBack = false) {
      const gameDiv = document.getElementById("game");
      gameDiv.innerHTML = "";

      // Special handling for the identity selection screen.
      if (nodeId === "identity_select") {
        const header = document.createElement("h2");
        header.textContent = "Choose Your Identity";
        gameDiv.appendChild(header);

        const nameInput = document.createElement("input");
        nameInput.type = "text";
        nameInput.placeholder = "Enter your name";
        nameInput.id = "playerName";
        gameDiv.appendChild(nameInput);

        const roleSelect = document.createElement("select");
        roleSelect.id = "playerRole";
        const roles = ["Farmer", "Laborer", "Activist", "Entrepreneur"];
        roles.forEach(role => {
          const option = document.createElement("option");
          option.value = role;
          option.textContent = role;
          roleSelect.appendChild(option);
        });
        gameDiv.appendChild(roleSelect);

        const startBtn = document.createElement("button");
        startBtn.textContent = "Start Your Adventure";
        startBtn.addEventListener("click", () => {
          const nameVal = document.getElementById("playerName").value.trim();
          if (!nameVal) {
            alert("Please enter your name.");
            return;
          }
          playerName = nameVal;
          playerRole = document.getElementById("playerRole").value;
          // Initialize game state.
          pathStack = [];
          transcript = [];
          navigateTo("start");
        });
        gameDiv.appendChild(startBtn);
        return;
      }

      // Get the current node.
      const node = storyNodes[nodeId];
      if (!isBack) {
        pathStack.push(nodeId);
        transcript.push(parseText(node.text));
      }

      // Display the node text.
      const nodeText = parseText(node.text);
      const para = document.createElement("p");
      para.style.whiteSpace = "pre-line";
      para.textContent = nodeText;
      gameDiv.appendChild(para);

      // Render choice buttons.
      if (node.choices) {
        node.choices.forEach(choice => {
          const btn = document.createElement("button");
          btn.textContent = choice.text;
          btn.className = "choice";
          btn.addEventListener("click", () => {
            navigateTo(choice.next);
          });
          gameDiv.appendChild(btn);
        });
      }

      // Navigation buttons: Back and Restart.
      const navDiv = document.createElement("div");
      navDiv.className = "nav-buttons";
      if (pathStack.length > 1) {
        const backBtn = document.createElement("button");
        backBtn.textContent = "Back";
        backBtn.addEventListener("click", goBack);
        navDiv.appendChild(backBtn);
      }
      const restartBtn = document.createElement("button");
      restartBtn.textContent = "Restart";
      restartBtn.addEventListener("click", restartGame);
      navDiv.appendChild(restartBtn);
      gameDiv.appendChild(navDiv);

      // If this is a final node, display the full transcript.
      if (node.final) {
        displayTranscript();
      }
    }

    // Navigate to a new node.
    function navigateTo(nodeId) {
      renderNode(nodeId);
    }

    // Go back one step.
    function goBack() {
      if (pathStack.length > 1) {
        pathStack.pop();
        transcript.pop();
        const previousNode = pathStack[pathStack.length - 1];
        renderNode(previousNode, true);
      }
    }

    // Restart the game.
    function restartGame() {
      playerName = "";
      playerRole = "";
      pathStack = [];
      transcript = [];
      renderNode("identity_select");
    }

    // Display the full journey transcript.
    function displayTranscript() {
      const gameDiv = document.getElementById("game");
      const transcriptDiv = document.createElement("div");
      transcriptDiv.id = "transcript";
      transcriptDiv.innerHTML = "<h3>Your Full Journey:</h3>" + transcript.join("\n\n---\n\n");
      gameDiv.appendChild(transcriptDiv);
    }

    // Start with the identity selection screen.
    renderNode("identity_select");
  </script>
</body>
</html>
