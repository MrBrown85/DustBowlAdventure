<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dust Bowl Adventure: Your Story in History</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    #game {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      line-height: 1.6;
    }
    button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
    }
    .choice {
      display: block;
      margin-top: 10px;
    }
    .nav-buttons {
      margin-top: 20px;
      border-top: 1px solid #ddd;
      padding-top: 10px;
    }
    #transcript {
      margin-top: 30px;
      background: #eef;
      border-left: 4px solid #88a;
      padding: 15px;
      font-style: italic;
      white-space: pre-line;
    }
    input[type="text"] {
      padding: 8px;
      font-size: 16px;
      width: 80%;
      margin-bottom: 10px;
    }
    select {
      padding: 8px;
      font-size: 16px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div id="game"></div>
  <script>
    // Global variables for player identity, navigation history, and transcript.
    let playerName = "";
    let playerRole = "";
    let pathStack = [];  // Stores the node IDs for "back" navigation.
    let transcript = []; // Stores the narrative text for the full transcript.

    // Helper function: Replace placeholders {name} and {role} in text.
    function parseText(text) {
      return text.replace(/{name}/g, playerName).replace(/{role}/g, playerRole);
    }

    // Story nodes with integrated narrative and historical information.
    const storyNodes = {
      // Identity selection is handled separately.
      "start": {
        text: "It is 1935. The relentless dust storms and economic collapse of the Great Depression have transformed the American heartland. You, {name} the {role}, stand at a crossroads amid the ruins of a once-fertile land. Unsustainable farming practices, drought, and the removal of native grasses have led to massive soil erosion and swirling dust that forces families to choose between staying on the land or seeking new hope in the city.",
        choices: [
          { text: "Stay on the farm and rebuild", next: "stay_farm" },
          { text: "Head to the city in search of opportunity", next: "city_intro" }
        ]
      },
      "stay_farm": {
        text: "You decide to remain on your ancestral farm. As you walk the barren fields, every gust of dust tells a story of environmental neglect and economic hardship. Once fertile lands have been reduced to wastelands by unsustainable practices—a harsh lesson in the need for soil conservation.",
        choices: [
          { text: "Risk salvaging what remains of your crops", next: "salvage_crops" },
          { text: "Conserve your few resources and wait", next: "conserve_resources" }
        ]
      },
      "salvage_crops": {
        text: "Determined, you battle the swirling dust to rescue your meager harvest. Though the yield is slim, it speaks to the resilience of those who refuse to give in—even when nature seems bent on erasing years of labor. Farmers in these times often risked everything on a single harvest.",
        choices: [
          { text: "Sell your harvest at the local market", next: "sell_crops" },
          { text: "Feed your family with what you saved", next: "feed_family" }
        ]
      },
      "conserve_resources": {
        text: "You choose caution over risk, conserving every resource while waiting for a change. The long, grueling days remind you how rationing and careful management became lifelines during the Depression, as communities learned to do more with less.",
        choices: [
          { text: "Invest in experimental farming techniques", next: "invest_techniques" },
          { text: "Seek help in a nearby town", next: "seek_assistance" }
        ]
      },
      "sell_crops": {
        text: "At the dusty market, you trade your fragile harvest for a few coins—a meager sum that reflects the collapse of crop prices during these desperate times. Every cent feels hard-won, a small victory against overwhelming odds.",
        choices: [
          { text: "Return to the farm to continue the struggle", next: "return_farm" },
          { text: "Save your money for a move to the city", next: "save_money_city" }
        ]
      },
      "feed_family": {
        text: "Your family gathers around a humble meal, each bite a reminder of both suffering and survival. In an era of widespread malnutrition, sharing even the smallest meal was an act of hope and unity.",
        choices: [
          { text: "Forage the land for more food", next: "find_food" },
          { text: "Set out on a risky barter journey", next: "barter_journey" }
        ]
      },
      "invest_techniques": {
        text: "You put your faith—and your few resources—into experimental farming. New methods like contour plowing and crop rotation, though not yet proven locally, offer a glimmer of hope against the ravages of erosion.",
        choices: [
          { text: "Double down on your efforts at home", next: "farm_success" },
          { text: "Consider leaving for the city", next: "city_intro" }
        ]
      },
      "seek_assistance": {
        text: "Traveling to a nearby town, you encounter others burdened by similar hardships. Local cooperatives and mutual aid groups had begun to form, proving that solidarity was sometimes the best remedy in desperate times.",
        choices: [
          { text: "Join a cooperative of local farmers", next: "join_cooperative" },
          { text: "Return home armed with new ideas", next: "return_farm" }
        ]
      },
      "return_farm": {
        text: "Back at your farm, you renew your commitment to the land. Every furrow you turn is a testament to human perseverance in the face of environmental and economic disaster.",
        choices: [
          { text: "Persevere with renewed determination", next: "farm_success" },
          { text: "Decide that the city may offer a better future", next: "city_intro" }
        ]
      },
      "save_money_city": {
        text: "You begin to carefully save every coin, planning for a future escape to the city—a place where, despite its own hardships, opportunities might still exist amid the crowded streets and shifting fortunes.",
        choices: [
          { text: "Stay on the farm a bit longer to save more", next: "wait_farm" },
          { text: "Use your savings and head to the city immediately", next: "city_intro" }
        ]
      },
      "find_food": {
        text: "Scouring the barren landscape, you forage wild edibles that nature still offers, however sparingly. In times when crops fail, foraging and community sharing were often the only ways to stave off hunger.",
        choices: [
          { text: "Return to your farm with the supplies", next: "return_farm" },
          { text: "Share your bounty with neighbors in need", next: "share_food" }
        ]
      },
      "barter_journey": {
        text: "You embark on a perilous journey to barter for essentials. With cash in short supply, direct exchanges of goods became a cornerstone of survival during the Depression.",
        choices: [
          { text: "Return home with your hard-won supplies", next: "return_farm" },
          { text: "Set up a small trade route with other farmers", next: "trade_route" }
        ]
      },
      "farm_success": {
        text: "Slowly but surely, your efforts bear fruit. The farm shows signs of recovery—a blend of traditional perseverance and innovative techniques that would later be championed by New Deal programs to revive American agriculture.",
        choices: [
          { text: "Keep toiling the land", next: "farm_success" },
          { text: "Expand your homestead for even greater promise", next: "expand_farm" },
          { text: "Tempt fate by trying your luck in the city", next: "city_intro" }
        ]
      },
      "join_cooperative": {
        text: "Embracing the spirit of community, you join a cooperative of farmers. By pooling resources and sharing knowledge, you and your neighbors create a bulwark against both nature’s fury and economic despair.",
        choices: [
          { text: "Work on communal farming projects", next: "communal_farming" },
          { text: "Eventually strike out on your own again", next: "return_farm" }
        ]
      },
      "communal_farming": {
        text: "Side by side with your neighbors, you cultivate a small, resilient plot of land. The joint effort not only improves yields but also forges bonds that will carry the community through the darkest days.",
        choices: [
          { text: "Celebrate your collective success", next: "ending_success" },
          { text: "Plan for further growth together", next: "invest_wisely" }
        ]
      },
      "expand_farm": {
        text: "With cautious optimism, you diversify your farm by adding livestock and experimenting with varied crops. This blend of agriculture was one strategy that eventually proved essential for sustainable farming.",
        choices: [
          { text: "Focus on raising livestock", next: "livestock" },
          { text: "Explore growing a variety of resilient crops", next: "diverse_crops" }
        ]
      },
      "wait_farm": {
        text: "Days turn into weeks as you wait, hoping that rain might return to revive the parched soil. The persistent drought of the Dust Bowl tested every farmer’s resolve, but also spurred innovations in water conservation.",
        choices: [
          { text: "Keep persevering on the land", next: "farm_success" },
          { text: "Join a caravan of migrants searching for fertile ground", next: "migrate" }
        ]
      },
      "trade_route": {
        text: "You gradually build a modest trade network with other local farmers. In an economy where cash was nearly extinct, barter and local exchange were lifelines that connected isolated communities.",
        choices: [
          { text: "Expand your network for even greater prosperity", next: "trade_growth" },
          { text: "Return to focus on your own farm", next: "farm_success" }
        ]
      },
      "livestock": {
        text: "You turn to raising livestock, finding that animals provide not only food but also a valuable commodity for trade. Livestock rearing became a critical alternative when crop yields failed.",
        choices: [
          { text: "Invest in building better animal shelters", next: "animal_shelters" },
          { text: "Use your livestock as a basis for barter", next: "trade_route" }
        ]
      },
      "diverse_crops": {
        text: "You experiment with a variety of crops, hoping that diversity will shield you from total failure. The lesson of the Dust Bowl taught farmers that relying on a single crop could spell disaster.",
        choices: [
          { text: "Keep experimenting with new crop combinations", next: "diverse_crops_success" },
          { text: "Return to traditional methods you know work", next: "farm_success" }
        ]
      },
      "migrate": {
        text: "With a heavy heart, you pack your few belongings and join a caravan of migrants heading west in search of better land. This exodus, immortalized in literature and film, was a desperate bid for survival.",
        choices: [
          { text: "Press on despite the hardships", next: "migrant_success" },
          { text: "Reconsider your choice and return home", next: "return_farm" }
        ]
      },
      "trade_growth": {
        text: "Your trade network blossoms slowly, providing modest gains despite the ever-looming threat of dust storms. Such local exchanges helped stabilize communities during the Depression.",
        choices: [
          { text: "Use your network to pursue greater prosperity", next: "prosperity" },
          { text: "Focus your efforts back on your own farm", next: "farm_success" }
        ]
      },
      "diverse_crops_success": {
        text: "Against all odds, your experiments with diverse crops begin to pay off. The breakthrough not only revives your farm but also signals the dawn of sustainable agricultural practices.",
        choices: [
          { text: "Continue innovating with new methods", next: "diverse_crops_success" },
          { text: "Return to the steadiness of traditional practices", next: "farm_success" }
        ]
      },
      "prosperity": {
        text: "Slow prosperity starts to shine through the hardships as both local initiatives and New Deal programs begin to revive the economy. Your journey is a testament to human resilience amid despair.",
        choices: [
          { text: "Invest your gains for a secure future", next: "invest_wisely" },
          { text: "Reinvest in growing your trade network", next: "trade_growth" }
        ]
      },
      "animal_shelters": {
        text: "Improving the shelters for your livestock brings better health and steady productivity. Such improvements were among the innovations that helped many farmers weather the Depression.",
        choices: [
          { text: "Expand your livestock operation further", next: "livestock_success" },
          { text: "Consider diversifying your farm once more", next: "diverse_crops" }
        ]
      },
      "livestock_success": {
        text: "Your successful livestock operation becomes a pillar of your local economy—a living example of adaptability and resilience during hard times.",
        choices: [
          { text: "Invest in the well-being of your community", next: "community_build" },
          { text: "Push for further expansion of your operations", next: "invest_wisely" }
        ]
      },
      "invest_wisely": {
        text: "You channel your hard-earned resources into local projects and small businesses, echoing the spirit of the New Deal. Your careful investments gradually help to rebuild not only your life, but the community around you.",
        choices: [
          { text: "Keep investing in a brighter future", next: "invest_wisely" },
          { text: "Strengthen your community ties", next: "community_build" }
        ]
      },
      "community_build": {
        text: "Together with your neighbors, you forge a resilient community that stands as a beacon of hope. The cooperation and mutual aid born in these desperate times lay the foundation for a better future.",
        choices: [
          { text: "Celebrate the triumph of your collective journey", next: "ending_success" },
          { text: "Plan for further communal growth", next: "invest_wisely" }
        ]
      },
      "ending_success": {
        text: "Your arduous journey through the Dust Bowl and the Great Depression culminates in a hard-won success. Your perseverance, innovation, and community spirit have left an indelible mark on history. This is your story—a testament to resilience in the face of overwhelming odds.",
        choices: [
          { text: "View Your Full Journey Transcript", next: "transcript_view" }
        ],
        final: true
      },
      "share_food": {
        text: "In an act of kindness, you share your foraged food with neighbors, reinforcing the bonds that held communities together during the darkest times. Such gestures of solidarity were as nourishing as any meal.",
        choices: [
          { text: "Return to your farm with renewed hope", next: "return_farm" },
          { text: "Help create a community garden", next: "community_build" }
        ]
      },
      // City branch nodes
      "city_intro": {
        text: "You arrive in the crowded city—a place where dreams and despair intermingle. The urban landscape during the Great Depression was rife with both hardship and the promise of reinvention. Overcrowded streets and fierce competition for work mirror the struggles back home.",
        choices: [
          { text: "Take any available labor job", next: "laborer" },
          { text: "Join a movement for political change", next: "activism" },
          { text: "Start a small business", next: "small_business" }
        ]
      },
      "laborer": {
        text: "You take on laborious work, enduring long hours and meager pay in a fight for survival. The grueling conditions in the city sparked the growth of unions and movements that demanded fair treatment for all workers.",
        choices: [
          { text: "Save money to eventually launch your own venture", next: "save_money_city" },
          { text: "Join a union to stand up for workers’ rights", next: "union_join" }
        ]
      },
      "activism": {
        text: "Driven by passion and a desire for change, you immerse yourself in political activism. The streets become stages for protests and grassroots movements that challenged an unjust system—actions that would eventually pave the way for the New Deal reforms.",
        choices: [
          { text: "Organize a large-scale protest", next: "protest" },
          { text: "Build grassroots support in your community", next: "grassroots" }
        ]
      },
      "small_business": {
        text: "Using your savings, you open a small business in the city. In a time when consumer spending had plummeted, every decision and every innovation was a gamble against the odds.",
        choices: [
          { text: "Invest in creative innovations to stand out", next: "business_innovation" },
          { text: "Cut costs to keep your business afloat", next: "business_cut" }
        ]
      },
      "save_money_city": {
        text: "You save every penny earned from labor, determined to build a better future. Even in a city where money was scarce, your discipline shines as a beacon of hope.",
        choices: [
          { text: "Continue working to save more", next: "laborer" },
          { text: "Use your savings to try a new opportunity", next: "small_business" }
        ]
      },
      "union_join": {
        text: "You join a union that fights for fair wages and safer working conditions. In these trying times, collective action was essential for protecting workers’ rights and dignity.",
        choices: [
          { text: "Take on a leadership role", next: "union_leader" },
          { text: "Focus on your work and save money", next: "laborer" }
        ]
      },
      "protest": {
        text: "Your protest fills the streets with chants for change. Risking confrontation with authorities, you join a movement that ultimately helped spur social reforms during the Depression.",
        choices: [
          { text: "Channel your protest energy into union efforts", next: "union_join" },
          { text: "Confront the authorities directly", next: "police_encounter" }
        ]
      },
      "grassroots": {
        text: "Working from the ground up, you help build local support networks that provided food, shelter, and hope amid urban poverty. These grassroots efforts laid the groundwork for many New Deal initiatives.",
        choices: [
          { text: "Form a local support group", next: "community_support" },
          { text: "Return to a steady labor job", next: "laborer" }
        ]
      },
      "business_innovation": {
        text: "Your innovative ideas begin to set your business apart in a competitive urban market. In a time when creativity was often the key to survival, your venture starts to gain traction.",
        choices: [
          { text: "Expand your business operations", next: "business_growth" },
          { text: "Keep your business small and focused", next: "business_stable" }
        ]
      },
      "business_cut": {
        text: "Cutting costs helps you keep the business afloat, though it risks compromising quality. Many entrepreneurs of the era had to balance frugality with the need to maintain a good reputation.",
        choices: [
          { text: "Invest in improving your product", next: "business_innovation" },
          { text: "Accept the slim margins and soldier on", next: "business_stable" }
        ]
      },
      "union_leader": {
        text: "Rising through the ranks, you become a union leader—an influential figure in the fight for workers’ rights. Your leadership echoes the broader struggle that eventually reshaped American labor laws.",
        choices: [
          { text: "Continue the fight for justice", next: "union_leader" },
          { text: "Return to your personal work", next: "laborer" }
        ]
      },
      "laborer_return": {
        text: "After a stint of activism, you return to labor work with renewed determination. The balance between personal survival and collective action defines many lives during the Depression.",
        choices: [
          { text: "Save money for a better future", next: "save_money_city" },
          { text: "Rejoin union efforts with fresh resolve", next: "union_join" }
        ]
      },
      "police_encounter": {
        text: "A confrontation with the authorities forces you into hiding. The tension between protestors and law enforcement was a stark reminder of the risks faced by those who dared to demand change.",
        choices: [
          { text: "Lay low and rebuild local support", next: "grassroots" },
          { text: "Continue your activism underground", next: "grassroots" }
        ]
      },
      "community_support": {
        text: "The support group you helped form becomes a lifeline for many urban dwellers. Mutual aid and solidarity provided the strength needed to endure the hardships of the Great Depression.",
        choices: [
          { text: "Use this network to rebuild community life", next: "community_build" },
          { text: "Return to your small business to create individual success", next: "small_business" }
        ]
      },
      "business_growth": {
        text: "Your business grows steadily, earning respect for quality and innovation. Expansion during the Depression required courage, resourcefulness, and a willingness to embrace risk.",
        choices: [
          { text: "Hire more workers and expand further", next: "business_employment" },
          { text: "Reinvest in your innovative methods", next: "business_innovation" }
        ]
      },
      "business_stable": {
        text: "Your business may not be booming, but it remains a stable source of income amid the economic turmoil. Stability was a rare and cherished achievement in these times.",
        choices: [
          { text: "Explore new ventures", next: "small_business" },
          { text: "Save money to change your circumstances", next: "save_money_city" }
        ]
      },
      "business_employment": {
        text: "By hiring additional workers, your business not only expands but also helps lift others out of hardship. Job creation was central to the recovery efforts that defined the New Deal era.",
        choices: [
          { text: "Invest in the welfare of your employees", next: "community_build" },
          { text: "Push for further expansion", next: "business_growth" }
        ]
      }
    };

    // Render a node (or a special screen) and add navigation buttons.
    function renderNode(nodeId, isBack = false) {
      const gameDiv = document.getElementById("game");
      gameDiv.innerHTML = "";

      // Special handling for the identity selection screen.
      if (nodeId === "identity_select") {
        const header = document.createElement("h2");
        header.textContent = "Choose Your Identity";
        gameDiv.appendChild(header);

        const nameInput = document.createElement("input");
        nameInput.type = "text";
        nameInput.placeholder = "Enter your name";
        nameInput.id = "playerName";
        gameDiv.appendChild(nameInput);

        const roleSelect = document.createElement("select");
        roleSelect.id = "playerRole";
        const roles = ["Farmer", "Laborer", "Activist", "Entrepreneur"];
        roles.forEach(role => {
          const option = document.createElement("option");
          option.value = role;
          option.textContent = role;
          roleSelect.appendChild(option);
        });
        gameDiv.appendChild(roleSelect);

        const startBtn = document.createElement("button");
        startBtn.textContent = "Start Your Adventure";
        startBtn.addEventListener("click", () => {
          const nameVal = document.getElementById("playerName").value.trim();
          if (!nameVal) {
            alert("Please enter your name.");
            return;
          }
          playerName = nameVal;
          playerRole = document.getElementById("playerRole").value;
          // Start at the "start" node.
          pathStack = []; transcript = [];
          navigateTo("start");
        });
        gameDiv.appendChild(startBtn);
        return;
      }

      // Get the current node.
      const node = storyNodes[nodeId];
      if (!isBack) {
        pathStack.push(nodeId);
        transcript.push(parseText(node.text));
      }
      // Parse text with dynamic player info.
      const nodeText = parseText(node.text);
      const para = document.createElement("p");
      para.style.whiteSpace = "pre-line";
      para.textContent = nodeText;
      gameDiv.appendChild(para);

      // Create buttons for choices.
      if (node.choices) {
        node.choices.forEach(choice => {
          const btn = document.createElement("button");
          btn.textContent = choice.text;
          btn.className = "choice";
          btn.addEventListener("click", () => {
            navigateTo(choice.next);
          });
          gameDiv.appendChild(btn);
        });
      }

      // Add navigation buttons ("Back" and "Restart")
      const navDiv = document.createElement("div");
      navDiv.className = "nav-buttons";
      // "Back" button is available if there is a previous node.
      if (pathStack.length > 1) {
        const backBtn = document.createElement("button");
        backBtn.textContent = "Back";
        backBtn.addEventListener("click", goBack);
        navDiv.appendChild(backBtn);
      }
      const restartBtn = document.createElement("button");
      restartBtn.textContent = "Restart";
      restartBtn.addEventListener("click", restartGame);
      navDiv.appendChild(restartBtn);
      gameDiv.appendChild(navDiv);

      // If the node is marked as final, display the full transcript.
      if (node.final) {
        displayTranscript();
      }
    }

    // Navigate to a new node.
    function navigateTo(nodeId) {
      renderNode(nodeId);
    }

    // Go back one step.
    function goBack() {
      if (pathStack.length > 1) {
        pathStack.pop();  // Remove current node.
        transcript.pop(); // Remove its transcript entry.
        const previousNode = pathStack[pathStack.length - 1];
        renderNode(previousNode, true);
      }
    }

    // Restart the game.
    function restartGame() {
      playerName = "";
      playerRole = "";
      pathStack = [];
      transcript = [];
      renderNode("identity_select");
    }

    // Display the full journey transcript at the end.
    function displayTranscript() {
      const gameDiv = document.getElementById("game");
      const transcriptDiv = document.createElement("div");
      transcriptDiv.id = "transcript";
      transcriptDiv.innerHTML = "<h3>Your Full Journey:</h3>" + transcript.join("\n\n---\n\n");
      gameDiv.appendChild(transcriptDiv);
    }

    // Start by showing the identity selection screen.
    renderNode("identity_select");
  </script>
</body>
</html>
