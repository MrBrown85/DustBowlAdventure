<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Historical Journey: The Dust Bowl and Depression</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 15px;
      line-height: 1.8;
      font-size: 18px;
    }
    #game {
      max-width: 100%;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.15);
    }
    h2, h3 {
      margin-top: 0;
    }
    input[type="text"], select {
      padding: 10px;
      font-size: 18px;
      width: 100%;
      margin-bottom: 15px;
      box-sizing: border-box;
    }
    button {
      margin: 8px 5px 8px 0;
      padding: 12px 15px;
      font-size: 18px;
      border: none;
      border-radius: 4px;
      background-color: #3498db;
      color: #fff;
      cursor: pointer;
    }
    button:hover {
      background-color: #2980b9;
    }
    .choice {
      display: block;
      margin-top: 12px;
      width: 100%;
      text-align: left;
    }
    .nav-buttons {
      margin-top: 25px;
      border-top: 1px solid #ddd;
      padding-top: 15px;
    }
    #transcript {
      margin-top: 30px;
      background: #eef;
      border-left: 4px solid #88a;
      padding: 15px;
      font-style: italic;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <div id="game"></div>
  <script>
    // Global variables for player's name, role, navigation path, and transcript.
    let playerName = "";
    let playerRole = "";
    let pathStack = [];  // Array of node IDs (for Back navigation)
    let transcript = []; // Array to store the full transcript text.

    // Utility: Replace placeholders in text.
    function parseText(text) {
      return text.replace(/{name}/g, playerName).replace(/{role}/g, playerRole);
    }

    // Story nodes. Each node has a "text" (narrative with historical facts)
    // and an array of "choices" (each with a "text" and "next" node id).
    // Nodes marked with final: true will display the transcript.
    const storyNodes = {
      "start": {
        text: "It is the autumn of 1935. The American Midwest is in crisis. The Dust Bowl—a period of severe dust storms and soil erosion—has devastated the farmlands. At the same time, the Great Depression has left millions struggling to survive. You, {name} the {role}, stand at a crossroads. Your family’s farm, once a symbol of prosperity, now lies cracked and barren. Historians explain that poor farming practices combined with a prolonged drought caused this environmental disaster. Your decision now will determine your future: do you remain on the land to attempt a revival, or do you seek a fresh start in the city?",
        choices: [
          { text: "Stay on the farm", next: "stayFarm" },
          { text: "Move to the city", next: "cityIntro" }
        ]
      },
      "stayFarm": {
        text: "You decide to stay on the farm. As you walk among the dry, cracked fields, you recall textbook lessons about how a lack of crop rotation and soil conservation led to massive erosion. Farmers later learned that new techniques such as contour plowing could help restore fertility. Now, you must choose your strategy to revive the land.",
        choices: [
          { text: "Try to salvage the remaining crops", next: "salvageCrops" },
          { text: "Conserve your resources and wait", next: "conserveResources" }
        ]
      },
      "salvageCrops": {
        text: "Braving the swirling dust, you work to gather the last of your crops. Although the harvest is small, it represents a spark of hope. During the Dust Bowl, many farmers risked everything to salvage their livelihoods. Your effort mirrors these brave attempts, reminding us that even in hardship, there is a chance for renewal.",
        choices: [
          { text: "Sell the harvest at the local market", next: "sellCrops" },
          { text: "Use the crops to feed your family", next: "feedFamily" }
        ]
      },
      "conserveResources": {
        text: "You decide that patience is key. By conserving food, water, and fuel, you mirror the survival strategies taught during the Great Depression. Families learned to stretch their resources during hard times. Meanwhile, new government programs would later promote better farming methods. With limited means, you must choose your next step carefully.",
        choices: [
          { text: "Experiment with new farming techniques", next: "investTechniques" },
          { text: "Visit a nearby town to get advice", next: "seekAssistance" }
        ]
      },
      "sellCrops": {
        text: "At the local market, you sell your modest harvest. The low prices reflect the harsh economic reality of the Depression when crop values plummeted. Despite the meager earnings, each coin is hard-won. This experience reinforces the lesson that economic hardship forced many farmers to rethink their methods and livelihoods.",
        choices: [
          { text: "Return to the farm to continue working", next: "returnFarm" },
          { text: "Save your money and consider moving to the city", next: "saveMoneyCity" }
        ]
      },
      "feedFamily": {
        text: "You choose to use your crops to feed your family. Sharing meals was a crucial part of surviving the Depression, and community support often helped families through the worst times. This decision, though difficult, underscores the importance of family and perseverance during crisis.",
        choices: [
          { text: "Forage for more food in the wild", next: "findFood" },
          { text: "Travel to barter for additional supplies", next: "barterJourney" }
        ]
      },
      "investTechniques": {
        text: "You invest your limited resources in experimenting with new farming methods, such as crop rotation and contour plowing. These techniques, which later became standard practices, were developed in response to the disasters of the Dust Bowl. Your efforts here are a practical application of the lessons learned by agricultural scientists in the 1930s.",
        choices: [
          { text: "Work hard to restore the farm", next: "farmSuccess" },
          { text: "Decide that the city might offer a better future", next: "cityIntro" }
        ]
      },
      "seekAssistance": {
        text: "You travel to a nearby town, where you meet other farmers and community members who share their experiences. During the Depression, many locals formed cooperatives and mutual aid groups to survive together. This exchange of ideas gives you valuable insight into alternative farming methods and community support.",
        choices: [
          { text: "Join a local cooperative", next: "joinCooperative" },
          { text: "Return to your farm with new ideas", next: "returnFarm" }
        ]
      },
      "returnFarm": {
        text: "Back on your farm, you resume your efforts with renewed determination. Each furrow you plow and each seed you plant is a step toward recovery. The lessons of the Dust Bowl eventually led to reforms that improved agricultural practices nationwide. Your story is now part of that larger historical narrative.",
        choices: [
          { text: "Continue working hard on the land", next: "farmSuccess" },
          { text: "Consider that the city may offer better opportunities", next: "cityIntro" }
        ]
      },
      "saveMoneyCity": {
        text: "You begin saving every coin you earn, planning for a possible move to the city. Many families left the rural areas during the Depression in search of new opportunities, even though urban life was also challenging. Saving money becomes a symbol of hope for a brighter future.",
        choices: [
          { text: "Stay on the farm a bit longer to save more", next: "waitFarm" },
          { text: "Use your savings and move to the city", next: "cityIntro" }
        ]
      },
      "findFood": {
        text: "You search the surrounding fields and woods for wild edibles. Foraging became an essential survival skill during the Dust Bowl when traditional crops failed. The discovery of natural food sources reinforces the idea that nature can still provide, even in the harshest conditions.",
        choices: [
          { text: "Return to your farm with the food", next: "returnFarm" },
          { text: "Share the food with your neighbors", next: "shareFood" }
        ]
      },
      "barterJourney": {
        text: "Deciding that money is scarce, you set out to barter for necessary supplies. During the Great Depression, exchanging goods was common when cash was in short supply. This system of trade helped many families survive and even build new relationships in their communities.",
        choices: [
          { text: "Return home with the supplies", next: "returnFarm" },
          { text: "Establish a small local trade route", next: "tradeRoute" }
        ]
      },
      "farmSuccess": {
        text: "Slowly, your hard work begins to pay off. The once barren fields show signs of recovery as new farming techniques help restore the soil. Your progress mirrors the gradual improvements that came about through both community effort and government programs during the New Deal. Your persistence is a powerful lesson in how innovation and determination can overcome even the worst challenges.",
        choices: [
          { text: "Continue improving the farm", next: "farmSuccess" },
          { text: "Try expanding your farm with new ideas", next: "expandFarm" },
          { text: "Consider moving to the city", next: "cityIntro" }
        ]
      },
      "joinCooperative": {
        text: "You join a local cooperative of farmers. Working together, you share resources, ideas, and labor. Cooperatives like these were an important part of how communities survived the Depression. The sense of unity and shared purpose gives you strength for the challenges ahead.",
        choices: [
          { text: "Work on communal farming projects", next: "communalFarming" },
          { text: "After gaining experience, return to manage your own farm", next: "returnFarm" }
        ]
      },
      "communalFarming": {
        text: "In the cooperative, you work side by side with your neighbors on a shared plot of land. The combined effort produces better results than working alone. This collaborative spirit is often highlighted in textbooks as a key factor in the eventual recovery of rural America.",
        choices: [
          { text: "Celebrate the community's success", next: "endingSuccess" },
          { text: "Plan for further community improvements", next: "investWisely" }
        ]
      },
      "expandFarm": {
        text: "With a desire to innovate, you decide to expand your farm. You add livestock and experiment with a variety of crops. This mixed approach helps reduce risk and is now recognized as a cornerstone of sustainable agriculture. Your farm begins to reflect both the old ways and the new methods learned from past mistakes.",
        choices: [
          { text: "Focus on raising livestock", next: "livestock" },
          { text: "Experiment with growing diverse crops", next: "diverseCrops" }
        ]
      },
      "waitFarm": {
        text: "You choose to remain on the farm a little longer, saving money and waiting for the weather to improve. The drought that caused the Dust Bowl also taught farmers the importance of water conservation. This waiting period, though difficult, is a necessary step toward eventual recovery.",
        choices: [
          { text: "Keep working on the land", next: "farmSuccess" },
          { text: "Join a group of migrants searching for better land", next: "migrate" }
        ]
      },
      "tradeRoute": {
        text: "You begin to build a local trade network with other farmers. By exchanging goods directly, families were able to support one another when money was scarce. This barter system became an important part of the survival strategy during the Depression.",
        choices: [
          { text: "Expand your trade network further", next: "tradeGrowth" },
          { text: "Focus on improving your own farm", next: "farmSuccess" }
        ]
      },
      "livestock": {
        text: "You focus on raising livestock. Animals provide meat, milk, and other valuable products. This strategy not only diversifies your income but also offers a more stable source of sustenance. Livestock rearing is now seen as a critical component of a balanced, sustainable farm.",
        choices: [
          { text: "Build better shelters for your animals", next: "animalShelters" },
          { text: "Use your animals to help in barter trades", next: "tradeRoute" }
        ]
      },
      "diverseCrops": {
        text: "You experiment with growing a range of crops that are more resistant to drought. This diversified planting strategy reduces the risk of total failure and is now widely recognized as a key to sustainable farming. Your innovative approach brings hope to the struggling land.",
        choices: [
          { text: "Continue refining your methods", next: "diverseCropsSuccess" },
          { text: "Return to the reliable methods of the past", next: "farmSuccess" }
        ]
      },
      "migrate": {
        text: "With a heavy heart, you join a caravan of migrants leaving the harsh conditions of the Dust Bowl. Many families made this difficult journey in search of more fertile lands and new opportunities. Though the road ahead is uncertain, this migration is a powerful testament to the resilience of the human spirit.",
        choices: [
          { text: "Press on in search of a new home", next: "migrantSuccess" },
          { text: "Decide to return to your farm", next: "returnFarm" }
        ]
      },
      "tradeGrowth": {
        text: "Your local trade network begins to flourish. The modest profits you earn show how communities adapted by relying on barter instead of cash. This system of exchange is a reminder of the innovative ways people found to support one another during the Depression.",
        choices: [
          { text: "Leverage your network for more prosperity", next: "prosperity" },
          { text: "Focus back on your own farm", next: "farmSuccess" }
        ]
      },
      "diverseCropsSuccess": {
        text: "Your experiments with diverse crops yield positive results. The once barren fields now show signs of life, and your innovative methods are beginning to work. This success is a clear lesson in how learning from past mistakes can lead to a brighter future in farming.",
        choices: [
          { text: "Continue to innovate", next: "diverseCropsSuccess" },
          { text: "Return to more traditional practices", next: "farmSuccess" }
        ]
      },
      "prosperity": {
        text: "Gradually, you see a sign of prosperity emerging from the long struggle. Your efforts, combined with new government programs, have helped stabilize the local economy. This period of recovery is a turning point in history, showing that hard work and innovation can lead to a better future.",
        choices: [
          { text: "Invest your gains in future improvements", next: "investWisely" },
          { text: "Expand your trade network further", next: "tradeGrowth" }
        ]
      },
      "animalShelters": {
        text: "By constructing sturdier shelters for your animals, you notice a marked improvement in their health and productivity. This practical step is one of many changes that helped farmers learn to work in harmony with nature. Your actions here reflect a broader shift toward sustainable agricultural practices.",
        choices: [
          { text: "Expand your livestock operations", next: "livestockSuccess" },
          { text: "Consider diversifying your farm again", next: "diverseCrops" }
        ]
      },
      "livestockSuccess": {
        text: "Your livestock operation becomes a dependable part of your farm’s income. The steady production of food and trade goods demonstrates the benefits of diversifying your farming methods. Your success is a testament to the resilience and adaptability that helped many survive the Depression.",
        choices: [
          { text: "Invest in community projects", next: "communityBuild" },
          { text: "Push for further expansion", next: "investWisely" }
        ]
      },
      "investWisely": {
        text: "You decide to invest your resources wisely by supporting local projects and small businesses. This approach reflects the spirit of the New Deal, which helped rebuild communities by encouraging local growth and economic stability. Your smart investments not only secure your future but also contribute to the recovery of the region.",
        choices: [
          { text: "Continue investing for future gains", next: "investWisely" },
          { text: "Strengthen community bonds", next: "communityBuild" }
        ]
      },
      "communityBuild": {
        text: "Working together with your neighbors, you build a strong, supportive community. This cooperation is recognized by historians as one of the key factors that helped America recover from the Great Depression. Your community’s success is a powerful reminder of what can be achieved when people unite for a common goal.",
        choices: [
          { text: "Celebrate your community's success", next: "endingSuccess" },
          { text: "Plan further improvements together", next: "investWisely" }
        ]
      },
      "endingSuccess": {
        text: "Your journey through the Dust Bowl and the Great Depression concludes with success. As {name} the {role}, you have faced adversity and emerged stronger by applying new ideas, working hard, and uniting with your community. Your story, full of practical lessons and historical insights, stands as an example of resilience and progress.",
        choices: [
          { text: "View Your Full Journey Transcript", next: "transcriptView" }
        ],
        final: true
      },
      "shareFood": {
        text: "In a generous act, you share your gathered food with neighbors who are struggling. This kindness, common during the Depression, helped build the strong community spirit that enabled many to survive difficult times.",
        choices: [
          { text: "Return to your farm with hope", next: "returnFarm" },
          { text: "Help establish a community garden", next: "communityBuild" }
        ]
      },
      // City branch nodes
      "cityIntro": {
        text: "You arrive in a bustling city where the promise of new opportunities is mixed with the harsh realities of urban life. The city during the Great Depression was marked by crowded streets, high unemployment, and fierce competition. Yet many people came here seeking work and a fresh start. The urban experience, though challenging, also offered the chance to learn new skills and join movements that fought for workers’ rights.",
        choices: [
          { text: "Take on a labor job", next: "laborer" },
          { text: "Get involved in activism", next: "activism" },
          { text: "Start a small business", next: "smallBusiness" }
        ]
      },
      "laborer": {
        text: "You begin working as a laborer in the city. Long hours, low pay, and difficult working conditions are the norm. This experience teaches you firsthand how the hardships of the Depression spurred the formation of unions and the fight for better wages and working conditions.",
        choices: [
          { text: "Save money for your future", next: "saveMoneyCity" },
          { text: "Join a union to demand better rights", next: "unionJoin" }
        ]
      },
      "activism": {
        text: "Motivated by a sense of justice, you become involved in political activism. You join protests and community meetings to demand improvements in living and working conditions. This activism played a significant role in the reforms that were later enacted as part of the New Deal.",
        choices: [
          { text: "Organize a public protest", next: "protest" },
          { text: "Help build grassroots support in your community", next: "grassroots" }
        ]
      },
      "smallBusiness": {
        text: "With your savings, you open a small business in the city. Though the economic climate is harsh, your venture represents the entrepreneurial spirit that emerged during the Depression. Running a business in these times required careful planning, innovation, and a willingness to take risks.",
        choices: [
          { text: "Focus on innovative ideas to attract customers", next: "businessInnovation" },
          { text: "Adopt cost-saving measures to survive", next: "businessCut" }
        ]
      },
      "saveMoneyCity": {
        text: "You work hard as a laborer, saving every dollar you can. The discipline and perseverance required to save money in the midst of urban hardship is a lesson in itself. Many during the Depression lived by saving what little they earned, hoping for a better future.",
        choices: [
          { text: "Keep working and saving", next: "laborer" },
          { text: "Invest your savings in a business opportunity", next: "smallBusiness" }
        ]
      },
      "unionJoin": {
        text: "You join a union to help fight for fair wages and improved working conditions. The union movement was a crucial force in the Depression era, leading to significant labor reforms. Your involvement shows the power of collective action.",
        choices: [
          { text: "Take on a leadership role in the union", next: "unionLeader" },
          { text: "Focus on your job and savings", next: "laborer" }
        ]
      },
      "protest": {
        text: "You help organize a public protest. The protests of the 1930s were key in drawing attention to the struggles of workers and the unemployed. Your efforts contribute to a broader movement that eventually led to improved labor laws and social reforms.",
        choices: [
          { text: "Support union efforts", next: "unionJoin" },
          { text: "Continue protesting for change", next: "protest" }
        ]
      },
      "grassroots": {
        text: "Working at the grassroots level, you join local community groups to help provide food and shelter to those in need. These efforts were critical in supporting many during the Depression and later inspired government relief programs.",
        choices: [
          { text: "Form a local support group", next: "communitySupport" },
          { text: "Return to steady labor work", next: "laborer" }
        ]
      },
      "businessInnovation": {
        text: "Your small business begins to stand out thanks to innovative ideas and quality service. In an environment of economic hardship, creativity was key to success. Your business becomes a symbol of hope and resilience in a difficult time.",
        choices: [
          { text: "Expand your business", next: "businessGrowth" },
          { text: "Keep your business small and focused", next: "businessStable" }
        ]
      },
      "businessCut": {
        text: "By focusing on cost-cutting measures, you manage to keep your business afloat. Although this approach limits growth, it is a practical way to survive in a tough economy. Many entrepreneurs during the Depression had to find a balance between quality and affordability.",
        choices: [
          { text: "Invest in improving your product", next: "businessInnovation" },
          { text: "Continue with your cost-saving strategy", next: "businessStable" }
        ]
      },
      "unionLeader": {
        text: "As a union leader, you help negotiate better wages and safer working conditions for your fellow workers. Your leadership is part of a movement that eventually resulted in significant labor reforms and improved quality of life for many.",
        choices: [
          { text: "Continue leading the union", next: "unionLeader" },
          { text: "Return to your personal work", next: "laborer" }
        ]
      },
      "communitySupport": {
        text: "The support group you helped form becomes an essential part of the community. In a time when government aid was limited, local initiatives like yours provided a lifeline for many families. Your work at the grassroots level shows the importance of community action in times of crisis.",
        choices: [
          { text: "Use the group to rebuild community life", next: "communityBuild" },
          { text: "Return to your business to pursue individual success", next: "smallBusiness" }
        ]
      },
      "businessGrowth": {
        text: "Your business grows steadily, creating jobs and contributing to the local economy. This success is a beacon of hope during the Depression and demonstrates how innovation and hard work can bring about positive change.",
        choices: [
          { text: "Hire more workers and expand further", next: "businessEmployment" },
          { text: "Reinvest in your innovative strategies", next: "businessInnovation" }
        ]
      },
      "businessStable": {
        text: "Your business remains stable despite the economic challenges. Stability in such a difficult time is a victory in itself, and your careful management is a lesson in resilience and perseverance.",
        choices: [
          { text: "Explore new business ventures", next: "smallBusiness" },
          { text: "Keep saving money for future changes", next: "saveMoneyCity" }
        ]
      },
      "businessEmployment": {
        text: "By hiring additional workers, your business not only grows but also helps create jobs for others. This act of employment generation was a key part of the New Deal efforts to revive the economy, and your success serves as a model for community-driven progress.",
        choices: [
          { text: "Invest in community projects", next: "communityBuild" },
          { text: "Push for further expansion", next: "businessGrowth" }
        ]
      },
      // Final transcript display node.
      "transcriptView": {
        text: "Thank you for completing your journey. Below is the full transcript of your choices and the historical lessons learned along the way.",
        choices: [],
        final: true
      }
    };

    // Function to render a node.
    function renderNode(nodeId, isBack = false) {
      const gameDiv = document.getElementById("game");
      gameDiv.innerHTML = "";

      // Special screen for identity selection.
      if (nodeId === "identity_select") {
        const header = document.createElement("h2");
        header.textContent = "Choose Your Identity";
        gameDiv.appendChild(header);

        const nameInput = document.createElement("input");
        nameInput.type = "text";
        nameInput.placeholder = "Enter your name";
        nameInput.id = "playerName";
        gameDiv.appendChild(nameInput);

        const roleSelect = document.createElement("select");
        roleSelect.id = "playerRole";
        const roles = ["Farmer", "Laborer", "Activist", "Entrepreneur"];
        roles.forEach(role => {
          const option = document.createElement("option");
          option.value = role;
          option.textContent = role;
          roleSelect.appendChild(option);
        });
        gameDiv.appendChild(roleSelect);

        const startBtn = document.createElement("button");
        startBtn.textContent = "Start Your Journey";
        startBtn.addEventListener("click", () => {
          const nameVal = document.getElementById("playerName").value.trim();
          if (!nameVal) {
            alert("Please enter your name.");
            return;
          }
          playerName = nameVal;
          playerRole = document.getElementById("playerRole").value;
          // Reset state and begin at the start node.
          pathStack = [];
          transcript = [];
          navigateTo("start");
        });
        gameDiv.appendChild(startBtn);
        return;
      }

      // Get current node.
      const node = storyNodes[nodeId];
      if (!isBack) {
        pathStack.push(nodeId);
        transcript.push(parseText(node.text));
      }

      // Display narrative text.
      const para = document.createElement("p");
      para.style.whiteSpace = "pre-line";
      para.textContent = parseText(node.text);
      gameDiv.appendChild(para);

      // Render choice buttons.
      if (node.choices && node.choices.length > 0) {
        node.choices.forEach(choice => {
          const btn = document.createElement("button");
          btn.textContent = choice.text;
          btn.className = "choice";
          btn.addEventListener("click", () => {
            navigateTo(choice.next);
          });
          gameDiv.appendChild(btn);
        });
      }

      // Navigation: Back and Restart.
      const navDiv = document.createElement("div");
      navDiv.className = "nav-buttons";
      if (pathStack.length > 1) {
        const backBtn = document.createElement("button");
        backBtn.textContent = "Back";
        backBtn.addEventListener("click", goBack);
        navDiv.appendChild(backBtn);
      }
      const restartBtn = document.createElement("button");
      restartBtn.textContent = "Restart";
      restartBtn.addEventListener("click", restartGame);
      navDiv.appendChild(restartBtn);
      gameDiv.appendChild(navDiv);

      // If node is final, display the transcript.
      if (node.final) {
        displayTranscript();
      }
    }

    // Navigate to a given node.
    function navigateTo(nodeId) {
      renderNode(nodeId);
    }

    // Go back one step.
    function goBack() {
      if (pathStack.length > 1) {
        pathStack.pop();
        transcript.pop();
        const previousNode = pathStack[pathStack.length - 1];
        renderNode(previousNode, true);
      }
    }

    // Restart the game.
    function restartGame() {
      playerName = "";
      playerRole = "";
      pathStack = [];
      transcript = [];
      renderNode("identity_select");
    }

    // Display the full transcript at the end.
    function displayTranscript() {
      const gameDiv = document.getElementById("game");
      const transcriptDiv = document.createElement("div");
      transcriptDiv.id = "transcript";
      transcriptDiv.innerHTML = "<h3>Your Full Journey:</h3>" + transcript.join("\n\n---\n\n");
      gameDiv.appendChild(transcriptDiv);
    }

    // Begin with the identity selection screen.
    renderNode("identity_select");
  </script>
</body>
</html>
